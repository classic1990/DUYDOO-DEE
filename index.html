<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DUYDODEE 4K - ดูซีรีส์จีนพากย์ไทย พรีเมียม</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Icon Library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/main.css">
</head>

<body class="custom-scrollbar min-h-screen flex flex-col">

    <!-- Navbar -->
    <header class="sticky top-0 z-50 glass-panel border-b-0">
        <div class="container mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-8">
                <a href="#" onclick="switchView('home')" class="text-2xl font-bold text-sky-500 tracking-tighter flex items-center gap-1">
                    <i class="fa-solid fa-play-circle"></i> DUYDODEE<span class="text-white">4K</span>
                </a>
                <nav class="hidden md:flex items-center gap-6 text-sm font-medium text-slate-300">
                    <a href="#" onclick="switchView('home')" class="hover:text-sky-400 transition">หน้าแรก</a>
                    <a href="#" class="hover:text-sky-400 transition">ซีรีส์จีน</a>
                    <a href="#" class="hover:text-sky-400 transition">พากย์ไทย</a>
                </nav>
            </div>
            
            <div class="flex items-center gap-4">
                <button id="themeToggleBtn" onclick="toggleTheme()" class="w-9 h-9 rounded-full bg-slate-800/50 hover:bg-slate-700 text-yellow-400 transition flex items-center justify-center border border-slate-700">
                    <i class="fa-solid fa-sun"></i>
                </button>
                <div class="relative hidden sm:block group">
                    <input type="text" id="searchInput" oninput="searchMovies()" placeholder="ค้นหาซีรีส์..." 
                        class="bg-slate-800/50 border border-slate-700 rounded-full py-1.5 px-4 pl-10 text-sm focus:outline-none focus:ring-2 focus:ring-sky-500 w-48 transition-all group-hover:w-64 text-slate-200">
                    <span class="absolute left-3 top-2 opacity-50"><i class="fa-solid fa-magnifying-glass"></i></span>
                </div>
                <!-- Admin Toggle Button -->
                <button id="adminBtn" onclick="switchView('admin')" class="hidden text-slate-400 hover:text-white text-sm bg-slate-800/50 p-2 rounded-full transition" title="จัดการหลังบ้าน">
                    <i class="fa-solid fa-gear"></i>
                </button>
                <button id="loginButton" onclick="openLoginModal()" class="bg-gradient-to-r from-sky-600 to-blue-700 hover:from-sky-500 hover:to-blue-600 px-5 py-1.5 rounded-full text-sm font-semibold shadow-lg shadow-sky-900/50 transition transform hover:-translate-y-0.5">
                    เข้าสู่ระบบ
                </button>
                <div id="loggedInUser" class="hidden items-center gap-3">
                    <span id="usernameDisplay" class="text-sm text-slate-300"></span>
                    <button id="logoutButton" class="text-slate-400 hover:text-white text-sm bg-red-500/10 hover:bg-red-500/20 px-3 py-1.5 rounded-full transition">
                        <i class="fa-solid fa-right-from-bracket mr-1"></i> ออกจากระบบ
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="flex-1 flex flex-col lg:flex-row container mx-auto px-4 py-6 gap-8 relative">

        <!-- Sidebar (Hidden on Mobile) -->
        <aside class="hidden lg:block w-60 flex-shrink-0">
            <div class="sticky top-24 space-y-8">
                <div>
                    <h3 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-4">เมนูหลัก</h3>
                    <div class="space-y-1">
                        <a href="#" onclick="switchView('home')" class="flex items-center gap-3 px-4 py-3 bg-slate-800/50 text-sky-400 rounded-xl font-medium border-l-4 border-sky-500 shadow-md transition-all hover:shadow-sky-500/10">
                            <i class="fa-solid fa-house"></i> หน้าแรก
                        </a>
                        <a href="#" class="flex items-center gap-3 px-4 py-3 text-slate-400 hover:bg-slate-800/30 hover:text-white rounded-xl transition">
                            <i class="fa-solid fa-fire"></i> มาแรง
                        </a>
                        <a href="#" class="flex items-center gap-3 px-4 py-3 text-slate-400 hover:bg-slate-800/30 hover:text-white rounded-xl transition">
                            <i class="fa-solid fa-clock"></i> ดูล่าสุด
                        </a>
                    </div>
                </div>

                <div>
                    <h3 class="text-xs font-bold text-slate-500 uppercase tracking-widest mb-4">หมวดหมู่</h3>
                    <div class="space-y-1">
                        <a href="#" onclick="filterCategory('china')" class="flex items-center justify-between px-4 py-2 text-slate-400 hover:text-sky-400 transition text-sm">
                            <span><i class="fa-solid fa-earth-asia mr-2 w-5"></i> จีน (China)</span>
                        </a>
                        <a href="#" onclick="filterCategory('inter')" class="flex items-center justify-between px-4 py-2 text-slate-400 hover:text-sky-400 transition text-sm">
                            <span><i class="fa-solid fa-earth-americas mr-2 w-5"></i> ฝรั่ง (Inter)</span>
                        </a>
                        <a href="#" onclick="filterCategory('anime')" class="flex items-center justify-between px-4 py-2 text-slate-400 hover:text-sky-400 transition text-sm">
                            <span><i class="fa-solid fa-film mr-2 w-5"></i> อนิเมะ (Anime)</span>
                        </a>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="flex-1 min-w-0">
            
            <!-- VIEW 1: HOME (Grid Movies) -->
            <div id="homeView" class="animate-fade-in">
                <!-- Hero Slider -->
                <div class="relative h-[250px] md:h-[350px] rounded-3xl overflow-hidden mb-10 group shadow-2xl shadow-sky-900/20 border border-slate-800">
                    <img src="https://image.tmdb.org/t/p/w1280/pi6l9j3gWb04fX07XjT4z554qGf.jpg" alt="Hero banner for Joy of Life 2" class="w-full h-full object-cover transform group-hover:scale-105 transition duration-700">
                    <div class="absolute inset-0 bg-gradient-to-t from-[#0f172a] via-[#0f172a]/40 to-transparent"></div>
                    <div class="absolute bottom-0 left-0 p-6 md:p-10">
                        <span class="bg-sky-600 text-white text-[10px] font-bold px-2 py-1 rounded mb-2 inline-block shadow-lg">UPDATE 2024</span>
                        <h1 class="text-3xl md:text-5xl font-bold text-white mb-2 text-shadow">หาญท้าชะตาฟ้า ภาค 2</h1>
                        <p class="text-slate-300 text-sm md:text-base line-clamp-2 max-w-2xl mb-4 text-shadow font-light">
                            การกลับมาของฟ่านเสียน... กับการต่อสู้ในราชสำนักที่เข้มข้นกว่าเดิม พบกับสุดยอดซีรีส์จีนฟอร์มยักษ์แห่งปี
                        </p>
                        <button onclick="openPlayer(1)" class="bg-white text-slate-900 hover:bg-sky-400 hover:text-white px-6 py-2.5 rounded-full font-bold transition flex items-center gap-2 shadow-lg shadow-white/10">
                            <i class="fa-solid fa-play"></i> ดูเลย
                        </button>
                    </div>
                </div>

                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold flex items-center gap-2 text-white">
                        <span class="w-1.5 h-6 bg-sky-500 rounded-full shadow-lg shadow-sky-500/50"></span>
                        อัปเดตล่าสุด
                    </h2>
                    <div class="flex gap-2">
                        <button class="w-8 h-8 rounded-full bg-slate-800 hover:bg-slate-700 flex items-center justify-center text-slate-400 transition"><i class="fa-solid fa-chevron-left"></i></button>
                        <button class="w-8 h-8 rounded-full bg-slate-800 hover:bg-slate-700 flex items-center justify-center text-slate-400 transition"><i class="fa-solid fa-chevron-right"></i></button>
                    </div>
                </div>

                <!-- Movie Grid Container -->
                <div id="movieGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-5 gap-4 sm:gap-6">
                    <!-- Javascript will render items here -->
                    <div class="col-span-full text-center py-20 text-slate-600">
                        <i class="fa-solid fa-spinner fa-spin text-3xl mb-3 text-sky-600"></i>
                        <p>กำลังโหลดหนัง...</p>
                    </div>
                </div>
            </div>

            <!-- VIEW 2: PLAYER (Pro Design) -->
            <div id="playerView" class="hidden animate-fade-in">
                <!-- Dynamic Background Backdrop -->
                <div id="playerBackdrop" class="fixed inset-0 z-[-1] opacity-20 bg-cover bg-center blur-3xl transition-all duration-700 pointer-events-none"></div>

                <div class="mb-6">
                    <button onclick="switchView('home')" class="text-slate-400 hover:text-white flex items-center gap-2 text-sm transition group px-4 py-2 rounded-lg hover:bg-slate-800/50 w-fit">
                        <i class="fa-solid fa-arrow-left group-hover:-translate-x-1 transition"></i> กลับหน้าหลัก
                    </button>
                </div>

                <!-- Video Player Container -->
                <div class="bg-black rounded-2xl overflow-hidden shadow-2xl shadow-black/80 border border-slate-700 aspect-video mb-8 relative group">
                    <iframe id="mainPlayer" class="w-full h-full" src="" frameborder="0" allowfullscreen></iframe>
                </div>

                <!-- Info & Episodes -->
                <div class="flex flex-col xl:flex-row gap-8 pb-10">
                    <!-- Left: Info -->
                    <div class="flex-1">
                        <div class="flex flex-col sm:flex-row items-start gap-6">
                            <img id="playerPoster" src="" alt="Movie Poster" class="w-32 md:w-40 rounded-lg shadow-2xl hidden sm:block border border-slate-700/50 object-cover aspect-[2/3]">
                            <div>
                                <h1 id="playerTitle" class="text-2xl md:text-4xl font-bold text-white mb-3 leading-tight text-shadow">ชื่อเรื่อง</h1>
                                <div class="flex flex-wrap items-center gap-3 mb-5 text-xs font-medium text-slate-300">
                                    <span id="playerYear" class="bg-slate-800 border border-slate-700 px-2 py-1 rounded">2024</span>
                                    <span class="flex items-center gap-1 text-yellow-400 bg-yellow-400/10 px-2 py-1 rounded border border-yellow-400/20"><i class="fa-solid fa-star"></i> <span id="playerRating">9.0</span></span>
                                    <span class="bg-sky-500/10 text-sky-400 border border-sky-500/20 px-2 py-1 rounded">พากย์ไทย</span>
                                </div>
                                <div id="playerDesc" class="text-slate-400 text-sm leading-relaxed mb-6 font-light">
                                    คำอธิบายเนื้อเรื่อง...
                                </div>
                                <div class="flex gap-3">
                                    <button class="bg-slate-800 hover:bg-slate-700 border border-slate-700 px-5 py-2.5 rounded-xl text-sm text-white transition flex items-center gap-2">
                                        <i class="fa-solid fa-heart"></i> ถูกใจ
                                    </button>
                                    <button class="bg-slate-800 hover:bg-slate-700 border border-slate-700 px-5 py-2.5 rounded-xl text-sm text-white transition flex items-center gap-2">
                                        <i class="fa-solid fa-share-nodes"></i> แชร์
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right: Episode Selector -->
                    <div class="w-full xl:w-96 flex-shrink-0">
                        <div class="glass-panel p-6 rounded-2xl border-slate-700/50">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="font-bold text-white flex items-center gap-2"><i class="fa-solid fa-layer-group text-sky-500"></i> เลือกตอน</h3>
                                <span class="text-xs text-slate-400 bg-slate-800 px-2 py-1 rounded-md" id="totalEpDisplay">40 ตอน</span>
                            </div>
                            <div id="episodeList" class="grid grid-cols-4 sm:grid-cols-5 gap-2 max-h-[300px] overflow-y-auto custom-scrollbar pr-2">
                                <!-- JS Injected -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW 3: ADMIN DASHBOARD (New Feature) -->
            <div id="adminView" class="hidden animate-fade-in">
                <div class="flex flex-col md:flex-row md:items-center justify-between mb-8 gap-4">
                    <div>
                        <h2 class="text-2xl font-bold text-white flex items-center gap-2"><i class="fa-solid fa-user-shield text-sky-500"></i> ระบบจัดการหนัง</h2>
                        <p class="text-slate-400 text-sm">จัดการข้อมูลหนังและซีรีส์ทั้งหมดในระบบ (Connected DB)</p>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="switchView('home')" class="px-4 py-2 bg-slate-800 rounded-lg text-slate-300 hover:bg-slate-700 text-sm border border-slate-700 transition">
                            <i class="fa-solid fa-arrow-left mr-2"></i> ไปหน้าเว็บ
                        </button>
                        <button onclick="exportMoviesToJSON()" class="px-4 py-2 bg-emerald-600/20 text-emerald-400 hover:bg-emerald-600 hover:text-white rounded-lg text-sm border border-emerald-600/50 transition">
                            <i class="fa-solid fa-file-export mr-2"></i> Export JSON
                        </button>
                        <button id="btnImportJSON" onclick="triggerImport()" class="px-4 py-2 bg-amber-600/20 text-amber-400 hover:bg-amber-600 hover:text-white rounded-lg text-sm border border-amber-600/50 transition">
                            <i class="fa-solid fa-file-import mr-2"></i> Import JSON
                        </button>
                        <input type="file" id="importFile" accept=".json" class="hidden" onchange="importMoviesFromJSON(event)">
                        <button onclick="openAddModal()" class="px-5 py-2 bg-gradient-to-r from-sky-600 to-blue-600 rounded-lg text-white hover:from-sky-500 hover:to-blue-500 text-sm font-bold shadow-lg shadow-sky-900/50 transition transform hover:scale-105 flex items-center">
                            <i class="fa-solid fa-plus mr-1"></i> เพิ่มหนังใหม่
                        </button>
                    </div>
                </div>

                <!-- Admin Search Bar -->
                <div class="mb-6 relative">
                    <input type="text" id="adminSearchInput" onkeyup="searchAdminMovies()" placeholder="ค้นหาหนังในระบบ (ชื่อ, ปี, ID)..." class="w-full glass-input rounded-xl px-4 py-3 pl-10 text-white focus:ring-2 focus:ring-sky-500 outline-none transition shadow-lg shadow-black/20">
                    <span class="absolute left-3 top-3.5 text-slate-400"><i class="fa-solid fa-magnifying-glass"></i></span>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <!-- Card 1: Total Movies -->
                    <div class="glass-panel p-6 rounded-2xl flex items-center gap-4 border-l-4 border-l-blue-500">
                        <div class="w-12 h-12 rounded-xl bg-blue-500/10 flex items-center justify-center text-blue-400 text-xl">
                            <i class="fa-solid fa-film"></i>
                        </div>
                        <div>
                            <p class="text-slate-400 text-[10px] uppercase font-bold tracking-wider">หนังทั้งหมด</p>
                            <h3 class="text-2xl font-bold text-white mt-1" id="adminTotalMovies">0</h3>
                        </div>
                    </div>

                    <!-- Card 2: Total Episodes -->
                    <div class="glass-panel p-6 rounded-2xl flex items-center gap-4 border-l-4 border-l-purple-500">
                        <div class="w-12 h-12 rounded-xl bg-purple-500/10 flex items-center justify-center text-purple-400 text-xl">
                            <i class="fa-solid fa-layer-group"></i>
                        </div>
                        <div>
                            <p class="text-slate-400 text-[10px] uppercase font-bold tracking-wider">ตอนทั้งหมด</p>
                            <h3 class="text-2xl font-bold text-white mt-1" id="adminTotalEpisodes">0</h3>
                        </div>
                    </div>

                    <!-- Card 3: Average Rating -->
                    <div class="glass-panel p-6 rounded-2xl flex items-center gap-4 border-l-4 border-l-yellow-500">
                        <div class="w-12 h-12 rounded-xl bg-yellow-500/10 flex items-center justify-center text-yellow-400 text-xl">
                            <i class="fa-solid fa-star"></i>
                        </div>
                        <div>
                            <p class="text-slate-400 text-[10px] uppercase font-bold tracking-wider">เรตติ้งเฉลี่ย</p>
                            <h3 class="text-2xl font-bold text-white mt-1" id="adminAvgRating">0.0</h3>
                        </div>
                    </div>

                    <!-- Card 4: API Status -->
                    <div class="glass-panel p-6 rounded-2xl flex items-center gap-4 border-l-4 border-l-green-500">
                        <div class="w-12 h-12 rounded-xl bg-green-500/10 flex items-center justify-center text-green-400 text-xl">
                            <i class="fa-solid fa-server"></i>
                        </div>
                        <div>
                            <p class="text-slate-400 text-[10px] uppercase font-bold tracking-wider">สถานะ API</p>
                            <h3 class="text-lg font-bold text-white mt-1 flex items-center gap-2">
                                <span class="relative flex h-2.5 w-2.5">
                                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                                  <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-green-500"></span>
                                </span>
                                Online
                            </h3>
                        </div>
                    </div>
                </div>

                <!-- Data Table -->
                <div class="glass-panel rounded-2xl overflow-hidden border border-slate-800">
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm text-slate-400">
                            <thead class="bg-slate-800/80 text-slate-200 uppercase font-bold text-xs">
                                <tr>
                                    <th class="px-6 py-4">โปสเตอร์</th>
                                    <th class="px-6 py-4 cursor-pointer hover:text-sky-400 select-none transition" onclick="sortMovies('title')">ชื่อเรื่อง <i id="sort-title" class="fa-solid fa-sort ml-1 text-slate-600"></i></th>
                                    <th class="px-6 py-4 cursor-pointer hover:text-sky-400 select-none transition" onclick="sortMovies('year')">รายละเอียด (ปี) <i id="sort-year" class="fa-solid fa-sort ml-1 text-slate-600"></i></th>
                                    <th class="px-6 py-4">ลิงก์วิดีโอ (ID)</th>
                                    <th class="px-6 py-4 text-right">จัดการ</th>
                                </tr>
                            </thead>
                            <tbody id="adminTableBody" class="divide-y divide-slate-800">
                                <!-- JS Injected -->
                            </tbody>
                        </table>
                    </div>
                    <!-- Pagination Controls -->
                    <div id="adminPagination" class="px-6 py-4 border-t border-slate-800/50 flex flex-col sm:flex-row items-center justify-between gap-4 bg-slate-900/20">
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Smart Modal Form (AI Auto-Fill) -->
    <div id="movieModal" class="fixed inset-0 bg-black/90 backdrop-blur-md z-[60] hidden flex items-center justify-center p-4">
        <div class="glass-panel border border-slate-600 w-full max-w-xl rounded-2xl shadow-2xl overflow-hidden transform transition-all scale-100 flex flex-col max-h-[90vh]" id="modalContent">
            
            <!-- Modal Header -->
            <div class="bg-slate-800/80 px-6 py-4 border-b border-slate-700 flex justify-between items-center">
                <h3 class="text-lg font-bold text-white flex items-center gap-2" id="modalTitle">
                    <i class="fa-solid fa-wand-magic-sparkles text-sky-400"></i> เพิ่มหนังใหม่
                </h3>
                <button onclick="closeModal()" class="text-slate-400 hover:text-white transition w-8 h-8 rounded-full hover:bg-slate-700 flex items-center justify-center"><i class="fa-solid fa-xmark text-lg"></i></button>
            </div>
            
            <!-- Modal Body -->
            <div class="p-6 overflow-y-auto custom-scrollbar">
                
                <!-- AI Import Section -->
                <div class="mb-6 p-4 bg-sky-900/20 border border-sky-500/30 rounded-xl relative overflow-hidden group">
                    <div class="absolute top-0 right-0 w-20 h-20 bg-sky-500/10 rounded-full blur-2xl transform translate-x-1/2 -translate-y-1/2"></div>
                    <label for="inpAiLink" class="block text-xs font-bold text-sky-400 mb-2 uppercase tracking-wide flex items-center gap-2">
                        <i class="fa-brands fa-youtube"></i> ดึงข้อมูลจาก YouTube (AI)
                    </label>
                    <div class="flex gap-2">
                        <input type="text" id="inpAiLink" placeholder="วางลิงก์ YouTube ที่นี่ (เช่น https://youtu.be/...)" 
                            class="flex-1 glass-input rounded-lg px-4 py-2.5 text-white focus:ring-2 focus:ring-sky-500 focus:border-transparent outline-none text-sm placeholder-slate-500">
                        <button onclick="aiAutoFill()" type="button" class="bg-sky-600 hover:bg-sky-500 text-white px-4 py-2 rounded-lg font-bold text-sm shadow-lg shadow-sky-900/30 transition flex items-center gap-2 whitespace-nowrap">
                            <i class="fa-solid fa-bolt"></i> ดึงข้อมูล
                        </button>
                    </div>
                    <p class="text-[10px] text-slate-400 mt-2 flex items-center gap-1">
                        <i class="fa-solid fa-circle-info"></i> รองรับลิงก์ทุกรูปแบบ ระบบจะดึงชื่อเรื่องและรูปปกให้ทันที
                    </p>
                </div>

                <form id="movieForm" class="space-y-5">
                    <input type="hidden" id="editId">
                    
                    <div class="flex gap-4 items-start">
                        <div class="flex-1 space-y-4">
                            <div>
                                <label for="inpTitle" class="block text-xs font-bold text-slate-400 mb-1">ชื่อเรื่อง</label>
                                <input type="text" id="inpTitle" required class="w-full glass-input rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-sky-500 outline-none transition">
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="inpYear" class="block text-xs font-bold text-slate-400 mb-1">ปีที่ฉาย</label>
                                    <input type="number" id="inpYear" value="2024" class="w-full glass-input rounded-lg px-4 py-2 text-white outline-none">
                                </div>
                                <div>
                                    <label for="inpRating" class="block text-xs font-bold text-slate-400 mb-1">เรตติ้ง (0-10)</label>
                                    <input type="number" step="0.1" id="inpRating" value="9.0" class="w-full glass-input rounded-lg px-4 py-2 text-white outline-none">
                                </div>
                            </div>
                            <div>
                                <label for="inpYt" class="block text-xs font-bold text-slate-400 mb-1">Youtube Video ID</label>
                                <input type="text" id="inpYt" required placeholder="เช่น dQw4w9WgXcQ" class="w-full bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 text-sky-400 font-mono text-sm outline-none">
                            </div>
                        </div>
                        
                        <!-- Poster Preview -->
                        <div class="w-32 flex-shrink-0">
                            <label for="posterPreview" class="block text-xs font-bold text-slate-400 mb-1">ตัวอย่างปก</label>
                            <div class="aspect-[2/3] bg-slate-900 rounded-lg border border-slate-700 overflow-hidden relative group">
                                <img id="posterPreview" src="https://via.placeholder.com/300x450?text=No+Image" alt="Poster preview" class="w-full h-full object-cover">
                                <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition flex items-center justify-center p-2 text-center">
                                    <span class="text-[10px] text-white">รูปจะเปลี่ยนตาม URL</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div>
                        <label for="inpCategory" class="block text-xs font-bold text-slate-400 mb-1">หมวดหมู่</label>
                        <select id="inpCategory" class="w-full glass-input rounded-lg px-4 py-2 text-white outline-none">
                            <option value="china" class="text-black">จีน (China)</option>
                            <option value="inter" class="text-black">ฝรั่ง (Inter)</option>
                            <option value="anime" class="text-black">อนิเมะ (Anime)</option>
                        </select>
                    </div>

                    <div>
                        <label for="inpEp" class="block text-xs font-bold text-slate-400 mb-1">จำนวนตอน</label>
                        <input type="number" id="inpEp" value="1" class="w-full glass-input rounded-lg px-4 py-2 text-white outline-none">
                    </div>

                    <div>
                        <label for="inpPoster" class="block text-xs font-bold text-slate-400 mb-1">Poster URL (รูปภาพ)</label>
                        <input type="url" id="inpPoster" oninput="updatePreview()" placeholder="https://..." class="w-full glass-input rounded-lg px-4 py-2 text-white outline-none text-xs text-slate-300">
                    </div>

                    <div class="pt-2 flex justify-end gap-3 border-t border-slate-700 mt-4">
                        <button type="button" onclick="closeModal()" class="px-5 py-2.5 rounded-xl text-slate-400 hover:bg-slate-800 transition text-sm font-medium">ยกเลิก</button>
                        <button type="submit" class="px-6 py-2.5 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white font-bold rounded-xl shadow-lg shadow-green-900/30 transition transform hover:scale-105 text-sm">
                            <i class="fa-solid fa-save mr-2"></i> บันทึกข้อมูล
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black/90 backdrop-blur-md z-[60] hidden flex items-center justify-center p-4">
        <div class="glass-panel border border-slate-600 w-full max-w-sm rounded-2xl shadow-2xl overflow-hidden transform transition-all scale-100 flex flex-col">
            <div class="bg-slate-800/80 px-6 py-4 border-b border-slate-700 flex justify-between items-center">
                <h3 class="text-lg font-bold text-white flex items-center gap-2">
                    <i class="fa-solid fa-right-to-bracket text-sky-400"></i> เข้าสู่ระบบผู้ดูแล
                </h3>
                <button onclick="closeLoginModal()" class="text-slate-400 hover:text-white transition w-8 h-8 rounded-full hover:bg-slate-700 flex items-center justify-center"><i class="fa-solid fa-xmark text-lg"></i></button>
            </div>
            <div class="p-6">
                <form id="loginForm" class="space-y-5">
                    <div>
                        <label for="inpUsername" class="block text-xs font-bold text-slate-400 mb-1">Username</label>
                        <input type="text" id="inpUsername" required class="w-full glass-input rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-sky-500 outline-none transition" value="admin">
                    </div>
                    <div>
                        <label for="inpPassword" class="block text-xs font-bold text-slate-400 mb-1">Password</label>
                        <input type="password" id="inpPassword" required class="w-full glass-input rounded-lg px-4 py-2 text-white focus:ring-2 focus:ring-sky-500 outline-none transition">
                    </div>
                    <p id="loginError" class="text-red-400 text-xs hidden"></p>
                    <div class="pt-2 flex justify-end gap-3">
                        <button type="submit" class="w-full px-6 py-2.5 bg-gradient-to-r from-sky-600 to-blue-600 hover:from-sky-500 hover:to-blue-500 text-white font-bold rounded-xl shadow-lg shadow-sky-900/30 transition transform hover:scale-105 text-sm">
                            <i class="fa-solid fa-lock mr-2"></i> เข้าสู่ระบบ
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="fixed top-5 right-5 z-[100] flex flex-col gap-3 pointer-events-none"></div>

    <footer class="mt-auto border-t border-slate-800 py-8 bg-[#0b1120]">
        <div class="container mx-auto px-4 text-center">
            <p class="text-slate-500 text-sm">© 2026 DUYDODEE 4K - ดูซีรีส์ออนไลน์คุณภาพสูง</p>
        </div>
    </footer>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        const API_URL = '/api';
        let allMovies = [];

        // ทำงานเมื่อโหลดหน้าเว็บเสร็จ
        document.addEventListener('DOMContentLoaded', () => {
            loadMovies();
            checkLogin();
        });

        // 1. ฟังก์ชันดึงข้อมูลหนังจาก Backend
        async function loadMovies() {
            try {
                const res = await fetch(`${API_URL}/movies`);
                const json = await res.json();
                if (json.success) {
                    allMovies = json.data;
                    renderMovies(allMovies);
                    renderAdminTable(allMovies);
                    updateAdminStats();
                }
            } catch (err) {
                console.error("Failed to load movies", err);
                document.getElementById('movieGrid').innerHTML = '<div class="col-span-full text-center text-red-400">ไม่สามารถเชื่อมต่อ Server ได้</div>';
            }
        }

        // 2. ฟังก์ชันแสดงผลหนัง (Render)
        function renderMovies(movies) {
            const grid = document.getElementById('movieGrid');
            if (!movies.length) {
                grid.innerHTML = '<div class="col-span-full text-center text-slate-500 py-10">ไม่พบข้อมูลหนัง</div>';
                return;
            }
            
            grid.innerHTML = movies.map(m => `
                <div class="group relative bg-slate-800 rounded-xl overflow-hidden shadow-lg hover:shadow-sky-500/20 transition duration-300 cursor-pointer border border-slate-700" 
                     onclick="openPlayer('${m.ytId}', '${escapeJsArg(m.title)}', '${escapeJsArg(m.description || '')}', '${escapeJsArg(m.lessons || '')}', '${escapeJsArg(m.actors || '')}', '${m.rating}', '${m.year}')">
                    <div class="aspect-[2/3] overflow-hidden relative">
                        <img src="${m.posterUrl}" alt="${m.title}" class="w-full h-full object-cover transform group-hover:scale-110 transition duration-500">
                        <div class="absolute inset-0 bg-black/0 group-hover:bg-black/40 transition flex items-center justify-center opacity-0 group-hover:opacity-100">
                            <i class="fa-solid fa-play-circle text-5xl text-white drop-shadow-lg transform scale-50 group-hover:scale-100 transition duration-300"></i>
                        </div>
                        <div class="absolute top-2 right-2 bg-black/60 backdrop-blur-sm text-yellow-400 text-xs font-bold px-2 py-1 rounded flex items-center gap-1">
                            <i class="fa-solid fa-star"></i> ${m.rating}
                        </div>
                    </div>
                    <div class="p-4">
                        <h3 class="text-white font-bold truncate group-hover:text-sky-400 transition text-sm">${m.title}</h3>
                        <div class="flex justify-between items-center mt-2 text-xs text-slate-400">
                            <span>${m.year}</span>
                            <span class="border border-slate-600 px-1.5 py-0.5 rounded text-[10px] uppercase bg-slate-700">${m.category}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Helper: ป้องกันตัวอักษรพิเศษทำโค้ดพัง
        function escapeJsArg(text) {
            if (!text) return '';
            // Escape backslashes, single quotes for JS string, and double quotes for HTML attribute
            return text.replace(/\\/g, '\\\\').replace(/'/g, "\\'").replace(/"/g, "&quot;").replace(/\n/g, ' ');
        }

        function escapeHtml(text) {
            return text.replace(/'/g, "&#039;").replace(/"/g, "&quot;").replace(/\n/g, ' ');
        }

        // 3. ฟังก์ชันเปิด Player
        function openPlayer(ytId, title, desc, lessons, actors, rating, year) {
            document.getElementById('homeView').classList.add('hidden');
            document.getElementById('playerView').classList.remove('hidden');
            
            document.getElementById('mainPlayer').src = `https://www.youtube.com/embed/${ytId}?autoplay=1&rel=0`;
            document.getElementById('playerTitle').innerText = title;
            document.getElementById('playerRating').innerText = rating || '0.0';
            document.getElementById('playerYear').innerText = year || '2024';
            
            let htmlContent = '';
            
            // ส่วนนักแสดง (Actors) - ปรับแต่ง CSS ให้เด่นขึ้น (สีฟ้า + ตัวหนา)
            if (actors) {
                htmlContent += `<div class="mb-3 text-sky-400 font-bold text-base"><i class="fa-solid fa-user-group mr-2"></i>นักแสดง: <span class="text-slate-200 font-normal">${escapeHtml(actors)}</span></div>`;
            }
            
            // เนื้อเรื่อง
            htmlContent += `<p class="mb-4">${escapeHtml(desc)}</p>`;
            
            // ข้อคิด (Lessons) - ตกแต่งเพิ่มเติม (กรอบสีเหลือง)
            if (lessons) {
                htmlContent += `<div class="p-3 bg-yellow-500/10 border border-yellow-500/20 rounded-lg text-yellow-200 text-sm"><i class="fa-solid fa-lightbulb text-yellow-400 mr-2"></i>ข้อคิด: ${escapeHtml(lessons)}</div>`;
            }
            
            document.getElementById('playerDesc').innerHTML = htmlContent;
            document.getElementById('playerPoster').src = `https://img.youtube.com/vi/${ytId}/maxresdefault.jpg`;
            
            window.scrollTo(0,0);
        }

        // 4. ฟังก์ชันสลับหน้า
        function switchView(view) {
            if (view === 'home') {
                document.getElementById('playerView').classList.add('hidden');
                document.getElementById('adminView').classList.add('hidden');
                document.getElementById('homeView').classList.remove('hidden');
                document.getElementById('mainPlayer').src = ''; // หยุดวิดีโอ
            } else if (view === 'admin') {
                document.getElementById('homeView').classList.add('hidden');
                document.getElementById('playerView').classList.add('hidden');
                document.getElementById('adminView').classList.remove('hidden');
                renderAdminTable(allMovies);
                updateAdminStats();
            }
        }

        // 5. ฟังก์ชันค้นหาและกรอง
        function filterCategory(cat) {
            renderMovies(allMovies.filter(m => m.category === cat));
        }

        function searchMovies() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            renderMovies(allMovies.filter(m => m.title.toLowerCase().includes(query)));
        }

        // 6. เช็คสถานะ Login
        function checkLogin() {
            const token = localStorage.getItem('accessToken');
            if (token) {
                document.getElementById('loginButton').classList.add('hidden');
                document.getElementById('loggedInUser').classList.remove('hidden');
                document.getElementById('loggedInUser').classList.add('flex');
                document.getElementById('usernameDisplay').innerText = 'Admin';
                document.getElementById('adminBtn').classList.remove('hidden');
            }
        }

        document.getElementById('logoutButton').onclick = () => {
            localStorage.removeItem('accessToken');
            window.location.reload();
        };

        // --- ส่วนที่เพิ่มใหม่: ฟังก์ชันเชื่อมต่อ API และจัดการ Modal ---

        function openLoginModal() {
            document.getElementById('loginModal').classList.remove('hidden');
        }
        function closeLoginModal() {
            document.getElementById('loginModal').classList.add('hidden');
        }
        function openModal() {
            document.getElementById('movieModal').classList.remove('hidden');
        }
        function closeModal() {
            document.getElementById('movieModal').classList.add('hidden');
        }
        function openAddModal() {
            document.getElementById('movieForm').reset();
            document.getElementById('editId').value = '';
            document.getElementById('modalTitle').innerHTML = '<i class="fa-solid fa-wand-magic-sparkles text-sky-400"></i> เพิ่มหนังใหม่';
            document.getElementById('posterPreview').src = 'https://via.placeholder.com/300x450?text=No+Image';
            openModal();
        }
        function updatePreview() {
            const url = document.getElementById('inpPoster').value;
            if(url) document.getElementById('posterPreview').src = url;
        }

        // 1. จัดการการ Login (เรียก API /api/login)
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('inpUsername').value;
            const password = document.getElementById('inpPassword').value;
            
            try {
                const res = await fetch(`${API_URL}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                const data = await res.json();
                
                if (data.success) {
                    localStorage.setItem('accessToken', data.accessToken);
                    closeLoginModal();
                    checkLogin();
                    alert('เข้าสู่ระบบสำเร็จ');
                } else {
                    const errEl = document.getElementById('loginError');
                    errEl.innerText = data.message;
                    errEl.classList.remove('hidden');
                }
            } catch (err) {
                console.error(err);
            }
        });

        // 3. จัดการ Form หนัง (Add/Edit)
        document.getElementById('movieForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('editId').value;
            const formData = {
                title: document.getElementById('inpTitle').value,
                year: document.getElementById('inpYear').value,
                rating: document.getElementById('inpRating').value,
                ytId: document.getElementById('inpYt').value,
                category: document.getElementById('inpCategory').value,
                posterUrl: document.getElementById('inpPoster').value,
                episodes: document.getElementById('inpEp').value
            };

            const method = id ? 'PUT' : 'POST';
            const url = id ? `${API_URL}/movies/${id}` : `${API_URL}/movies`;

            try {
                const res = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                const result = await res.json();
                if (result.success) {
                    alert('บันทึกข้อมูลสำเร็จ');
                    closeModal();
                    loadMovies();
                } else {
                    alert('เกิดข้อผิดพลาด: ' + result.message);
                }
            } catch (error) {
                console.error(error);
                alert('เชื่อมต่อ Server ไม่ได้');
            }
        });

        // 4. ฟังก์ชัน Admin (Render Table, Edit, Delete)
        function renderAdminTable(movies) {
            const tbody = document.getElementById('adminTableBody');
            if (!tbody) return;
            tbody.innerHTML = movies.map(m => `
                <tr class="hover:bg-slate-800/50 transition group border-b border-slate-800/50">
                    <td class="px-6 py-4">
                        <img src="${m.posterUrl}" class="w-10 h-14 object-cover rounded shadow-md bg-slate-800">
                    </td>
                    <td class="px-6 py-4 font-medium text-white">${m.title}</td>
                    <td class="px-6 py-4 text-slate-400">${m.year}</td>
                    <td class="px-6 py-4 font-mono text-xs text-sky-400">${m.ytId}</td>
                    <td class="px-6 py-4 text-right space-x-2">
                        <button onclick="editMovie(${m.id})" class="text-slate-400 hover:text-sky-400 transition p-2"><i class="fa-solid fa-pen-to-square"></i></button>
                        <button onclick="deleteMovie(${m.id})" class="text-slate-400 hover:text-red-400 transition p-2"><i class="fa-solid fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }

        function updateAdminStats() {
            document.getElementById('adminTotalMovies').innerText = allMovies.length;
            const avg = allMovies.reduce((acc, m) => acc + parseFloat(m.rating || 0), 0) / (allMovies.length || 1);
            document.getElementById('adminAvgRating').innerText = avg.toFixed(1);
        }

        function searchAdminMovies() {
            const query = document.getElementById('adminSearchInput').value.toLowerCase();
            const filtered = allMovies.filter(m => m.title.toLowerCase().includes(query) || String(m.year).includes(query));
            renderAdminTable(filtered);
        }

        function editMovie(id) {
            const movie = allMovies.find(m => m.id === id);
            if (!movie) return;
            document.getElementById('editId').value = movie.id;
            document.getElementById('inpTitle').value = movie.title;
            document.getElementById('inpYear').value = movie.year;
            document.getElementById('inpRating').value = movie.rating;
            document.getElementById('inpYt').value = movie.ytId;
            document.getElementById('inpCategory').value = movie.category;
            document.getElementById('inpPoster').value = movie.posterUrl;
            document.getElementById('inpEp').value = movie.episodes || 1;
            document.getElementById('modalTitle').innerHTML = '<i class="fa-solid fa-pen-to-square text-sky-400"></i> แก้ไขหนัง';
            updatePreview();
            openModal();
        }

        async function deleteMovie(id) {
            if (!confirm('คุณต้องการลบหนังเรื่องนี้ใช่หรือไม่?')) return;
            try {
                const res = await fetch(`${API_URL}/movies/${id}`, { method: 'DELETE' });
                const data = await res.json();
                if (data.success) {
                    loadMovies();
                } else {
                    alert('ลบไม่สำเร็จ: ' + data.message);
                }
            } catch (err) {
                alert('เชื่อมต่อ Server ไม่ได้');
            }
        }

        // 2. ฟังก์ชัน AI Auto-Fill (เรียก API /api/fetch-movie-data)
        async function aiAutoFill() {
            const url = document.getElementById('inpAiLink').value;
            if (!url) return alert('กรุณาใส่ลิงก์ YouTube');
            
            // ดึง Video ID จากลิงก์
            let videoId = url;
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(regExp);
            if (match && match[2].length === 11) videoId = match[2];

            const token = localStorage.getItem('accessToken');
            if (!token) return alert('กรุณาเข้าสู่ระบบก่อนใช้งาน AI');

            try {
                const res = await fetch(`${API_URL}/fetch-movie-data`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                    body: JSON.stringify({ videoId })
                });
                const json = await res.json();
                if (json.success) {
                    document.getElementById('inpTitle').value = json.data.title;
                    document.getElementById('inpYear').value = json.data.year;
                    document.getElementById('inpRating').value = json.data.rating;
                    document.getElementById('inpYt').value = json.data.ytId;
                    document.getElementById('inpPoster').value = json.data.posterUrl;
                    updatePreview();
                } else {
                    alert(json.message);
                }
            } catch (err) {
                alert('เกิดข้อผิดพลาด: ' + err.message);
            }
        }
    </script>
</body>
</html>